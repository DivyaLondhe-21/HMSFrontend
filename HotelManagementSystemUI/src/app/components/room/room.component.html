<div class="container">
  <h2 class="title">Room List</h2>

  <!-- Add Room Button -->
  <button (click)="openAddRoomModal()" class="add-room-btn">+ Add Room</button>

  <!-- Room Table -->
  <div class="table-container">
    <table class="room-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Type</th>
          <th>Check-In</th>
          <th>Check-Out</th>
          <th>Availability</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let room of rooms" class="room-row">
          <td>{{ room.roomID }}</td>
          <td>{{ room.roomType }}</td>
          <td>{{ room.checkInDate | date:'yyyy-MM-dd' }}</td> 
          <td>{{ room.checkOutDate | date:'yyyy-MM-dd' }}</td>
          <td>
            <span
              [ngClass]="{
                'available': room.availability,
                'booked': !room.availability
              }"
            >
              {{ room.availability ? 'Available' : 'Booked' }}
            </span>
          </td>
          <td class="action-buttons">
            <button (click)="GetRatesForRoom(room.roomID)" class="btn view-btn"> View Rates </button>
            <button (click)="editRoom(room)" class="btn edit-btn">Edit </button>
            <button (click)="DeleteRoom(room.roomID)" class="btn delete-btn">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
    <div *ngIf="showRatesModal" class="modal">
      <div class="modal-content">
        <h2>Rates for Room {{ selectedRoom?.roomType }}</h2>
        <table *ngIf="rates.length > 0; else noRates">
          <thead>
            <tr>
              <th>Rate ID</th>
              <th>First Night Price</th>
              <th>Extension Price</th>
              <th>Number of Children</th>
              <th>Number of Guests</th>
              <th>Number of Days</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let rate of rates">
              <td>{{ rate.rateId }}</td>
              <td>{{ rate.firstNightPrice | currency }}</td>
              <td>{{ rate.extensionPrice | currency }}</td>
              <td>{{ rate.numberOfChildren }}</td>
              <td>{{ rate.numberOfGuests }}</td>
              <td>{{ rate.numberOfDays }}</td>
            </tr>
          </tbody>
        </table>
        <!-- Template displayed if no rates are available -->
        <ng-template #noRates>
          <p>No rates available for this room.</p>
        </ng-template>
    
        <!-- Close button for the modal -->
        <button type="button" (click)="closeRatesModal()">Close</button>
      </div>
    </div>
    <div *ngIf="selectedRoom">
  <h3>Edit Room</h3>
  <form [formGroup]="editRoomForm" (ngSubmit)="UpdateRoom()">
    <label for="roomID">Room ID:</label>
    <input id="roomID" formControlName="roomID" type="text" [readonly]="true" />

    <label for="roomType">Room Type:</label>
    <input id="roomType" formControlName="roomType" type="text" />

    <label for="checkInDate">Check-in Date:</label>
    <input id="checkInDate" formControlName="checkInDate" type="date" />

    <label for="checkOutDate">Check-out Date:</label>
    <input id="checkOutDate" formControlName="checkOutDate" type="date" />

    <label for="availability">Availability:</label>
    <input id="availability" formControlName="availability" type="checkbox" />

    <button type="submit" [disabled]="!editRoomForm.valid">Save</button>
    <button type="button" (click)="cancelEdit()">Cancel</button>
  </form>
</div>
  </div>

  <!-- Show rates for selected room -->
  <div *ngIf="selectedRoom" class="rates-section">
    <app-rate [roomRates]="rates"></app-rate>
  </div>

  <!-- Add/Edit Room Modal -->
  <div class="modal-overlay" *ngIf="showAddRoomModal || showEditRoomModal">
    <div class="modal-content">
      <h3 class="modal-title">
        {{ showEditRoomModal ? 'Edit Room' : 'Add New Room' }}
      </h3>
      <form
        (ngSubmit)="showEditRoomModal ? UpdateRoom() : AddRoom()"
        #roomForm="ngForm"
        class="form-container"
      >
        <label for="roomType">Room Type:</label>
        <input
          type="text"
          id="roomType"
          [(ngModel)]="newRoom.roomType"
          name="roomType"
          required
          class="input-field"
        />


        <label for="availability">Availability:</label>
        <select
          id="availability"
          [(ngModel)]="newRoom.availability"
          name="availability"
          required
          class="select-field"
        >
          <option [value]="true">Available</option>
          <option [value]="false">Booked</option>
        </select>

        <!-- Modal Buttons -->
        <div class="modal-buttons">
          <button type="submit" class="btn save-btn">
            {{ showEditRoomModal ? 'Update Room' : 'Add Room' }}
          </button>
          <button
            type="button"
            (click)="closeAddRoomModal()"
            class="btn cancel-btn"
          >
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
